<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Junta Calificadora de Méritos y Disciplina - Nivel Secundario</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #003087;
            --secondary: #28a745;
            --background: #f5f7fa;
            --text: #1a202c;
            --accent: #ff8c00;
            --space-unit: 8px;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: calc(var(--space-unit) * 4) auto;
            background: white;
            padding: calc(var(--space-unit) * 3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            margin-top: calc(var(--space-unit) * 10); /* Añadido para evitar solapamiento con el header sticky */
        }

        h1, h2, h3, h4 {
            color: var(--primary);
            margin-bottom: calc(var(--space-unit) * 3);
        }

        h1 {
            font-size: clamp(2rem, 5vw, 2.5rem);
            font-weight: 700;
            line-height: 1.3;
            text-align: center;
        }

        h2 {
            font-size: clamp(1.6rem, 4vw, 2rem);
            font-weight: 500;
            line-height: 1.4;
            border-bottom: 2px solid #d0d0e6;
            padding-bottom: calc(var(--space-unit));
        }

        h3 {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 400;
            text-align: left;
            border-bottom: 1px solid #d0dae6;
            padding-bottom: calc(var(--space-unit));
        }

        h3 small {
            display: block;
            font-size: 0.7em;
            color: #666;
            margin-top: calc(var(--space-unit));
            font-weight: 300;
        }

        h4 {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            font-weight: 500;
            color: var(--accent);
            margin-top: calc(var(--space-unit) * 3);
        }

        p {
            font-size: 1rem;
            line-height: 1.8;
            font-weight: 300;
            text-align: justify;
            margin-bottom: calc(var(--space-unit) * 2);
        }

        header {
            background: linear-gradient(to right, var(--primary), #004aad);
            color: white;
            padding: calc(var(--space-unit) * 3) 0; /* Aumentado para que el banner no se vea achicado */
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        header .logo {
            max-height: 60px; /* Reducido para controlar el tamaño del logo */
            max-width: 200px; /* Añadido para limitar el ancho del logo */
        }

        header .logo img {
            display: block; /* Para evitar espacio extra debajo de la imagen */
            max-height: 100%; /* Se ajusta al contenedor */
            max-width: 100%; /* Se ajusta al contenedor */
            width: auto;
            height: auto;
        }

        header nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center; /* Añadido para centrar verticalmente los enlaces */
        }

        header li {
            margin-left: calc(var(--space-unit) * 3);
        }

        header li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            transition: color 0.3s ease-in-out;
        }

        header li a:hover, header li a:focus {
            color: #a7d9ff;
            outline: 3px solid var(--accent);
            outline-offset: 2px;
        }

        .content-section {
            padding: calc(var(--space-unit) * 2) 0;
            margin-bottom: calc(var(--space-unit) * 5);
            border-bottom: 1px dashed #e0e7ed;
        }

        .content-section:last-of-type {
            border-bottom: none;
        }

        .content-section ul {
            list-style: disc inside;
            margin-left: calc(var(--space-unit) * 2);
            margin-bottom: calc(var(--space-unit) * 2);
        }

        .content-section ul li {
            margin-bottom: calc(var(--space-unit-unit));
        }

        .content-section a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 400;
        }

        .content-section a:hover, .content-section a:focus {
            text-decoration: underline;
            outline: 3px solid var(--accent);
            outline-offset: 2px;
        }

        .search-group {
            margin-bottom: calc(var(--space-unit) * 5);
            padding: calc(var(--space-unit) * 3);
            border: 1px solid #dbe2ea;
            border-radius: 12px;
            background-color: #fcfcff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .search-group h3 {
            margin-top: 0;
        }

        .search-section {
            margin-bottom: calc(var(--space-unit) * 3);
            padding: calc(var(--space-unit) * 2);
            border: 1px solid #dbe2ea;
            border-radius: 10px;
            background-color: #f7f9fc;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.07);
        }

        .search-section label {
            display: block;
            margin-bottom: calc(var(--space-unit));
            font-weight: 600;
            color: #333;
        }

        .search-section input[type="text"],
        .search-section select {
            width: calc(100% - 22px);
            padding: calc(var(--space-unit) * 1.5);
            margin-bottom: calc(var(--space-unit) * 2);
            border: 1px solid #c2d1e6;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .search-section button {
            background-color: var(--secondary);
            color: white;
            padding: calc(var(--space-unit) * 1.5) calc(var(--space-unit) * 3);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2);
        }

        .search-section button:hover, .search-section button:focus {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.3);
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .results-container {
            margin-top: calc(var(--space-unit) * 3);
            border-top: 2px solid #e0e6ed;
            padding-top: calc(var(--space-unit) * 3);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: calc(var(--space-unit) * 2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow-x: auto;
            display: block;
        }

        .results-table th, .results-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }

        .results-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .results-table tr:nth-child(even) {
            background-color: #f2f7fa;
        }

        .results-table tr:hover {
            background-color: #e9f2fa;
        }

        .results-table tr.highlighted-row {
            background-color: #e6ffe6;
            border-left: 5px solid var(--secondary);
        }

        .results-table th:nth-child(3),
        .results-table td:nth-child(3) {
            text-align: center;
            font-weight: bold;
            width: 10%;
        }

        .no-results {
            text-align: center;
            color: #777;
            padding: 2rem;
            font-style: italic;
        }

        .news-iframe-container, .map-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background-color: #f0f0f0;
        }

        .news-iframe-container iframe, .map-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        footer {
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: calc(var(--space-unit) * 3);
            margin-top: calc(var(--space-unit) * 5);
            border-top: 5px solid var(--primary);
            font-size: 0.9rem;
        }

        .quick-access-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: calc(var(--space-unit) * 2);
            margin: calc(var(--space-unit) * 3) 0;
        }

        .quick-access-buttons .button {
            background-color: var(--secondary);
            color: white;
            padding: calc(var(--space-unit) * 1.5) calc(var(--space-unit) * 3);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 200px;
        }

        .quick-access-buttons .button:hover, .quick-access-buttons .button:focus {
            background-color: #218838;
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.4);
            outline: 3px solid var(--accent);
            outline-offset: 2px;
        }

        .back-to-top {
            position: fixed;
            bottom: calc(var(--space-unit) * 2);
            right: calc(var(--space-unit) * 2);
            background-color: var(--primary);
            color: white;
            padding: calc(var(--space-unit));
            border-radius: 50%;
            display: none;
            cursor: pointer;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        .back-to-top.active {
            display: block;
            opacity: 1;
        }

        .loader {
            display: none;
            text-align: center;
            padding: calc(var(--space-unit) * 2);
            font-size: 1.2rem;
            color: var(--primary);
        }

        .loader.active {
            display: block;
        }

        .tutorial {
            background-color: #f7f9fc;
            padding: calc(var(--space-unit) * 2);
            border-radius: 8px;
            margin-bottom: calc(var(--space-unit) * 2);
            border-left: 4px solid var(--accent);
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: calc(var(--space-unit) * 2); /* Añadido para espaciar logo y navegación */
            }

            header {
                padding: calc(var(--space-unit) * 2) 0; /* Ajustado para pantallas pequeñas */
            }

            header .logo {
                max-height: 50px; /* Reducido aún más para móviles */
                max-width: 150px; /* Ajustado para móviles */
                margin-bottom: calc(var(--space-unit) * 2); /* Espacio debajo del logo */
            }

            header nav ul {
                flex-direction: column;
                margin-top: 0; /* Ajustado para no añadir espacio extra */
                gap: calc(var(--space-unit)); /* Espacio entre elementos de navegación */
            }

            header li {
                margin: calc(var(--space-unit) * 0.5) 0; /* Ajustado para consistencia */
            }

            .container {
                width: 95%;
                padding: calc(var(--space-unit) * 2);
                margin-top: calc(var(--space-unit) * 12); /* Aumentado para evitar solapamiento en móviles */
            }

            h1 { 
                font-size: clamp(1.5rem, 4vw, 2rem); 
                margin-top: calc(var(--space-unit) * 2); /* Añadido para espacio extra en móviles */
            }
            h2 { font-size: clamp(1.3rem, 3.5vw, 1.7rem); }
            h3 { font-size: clamp(1rem, 3vw, 1.3rem); }

            .search-section input[type="text"], .search-section select {
                width: 100%;
            }

            .news-iframe-container, .map-container {
                padding-top: 75%;
            }

            .quick-access-buttons {
                flex-direction: column;
                align-items: center;
            }

            .quick-access-buttons .button {
                width: 80%;
                min-width: unset;
                padding: calc(var(--space-unit)) calc(var(--space-unit) * 2);
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="loader" id="loader"><i class="fas fa-spinner fa-spin"></i> Cargando datos...</div>

    <header>
        <div class="header-content">
            <div class="logo">
                <img src="jcmyd-logo.png" alt="Logo Junta Calificadora de Méritos y Disciplina">
            </div>
            <nav>
                <ul>
                    <li><a href="#inicio">Inicio</a></li>
                    <li><a href="#sobre-nosotros">Sobre Nosotros</a></li>
                    <li><a href="#herramientas-consulta">Herramientas de Consulta</a></li>
                    <li><a href="#normativas">Normativas</a></li>
                    <li><a href="#tramites">Trámites y Consultas</a></li>
                    <li><a href="#noticias">Noticias</a></li>
                    <li><a href="#contacto">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <section id="inicio" class="content-section">
            <h1>Junta Calificadora de Méritos y Disciplina - Nivel Secundario</h1>
            <p>Plataforma oficial para docentes de Salta. Encuentra recursos, normativas y herramientas para tu carrera.</p>
            <p>Accede a información transparente sobre incumbencias, convocatorias y colegios.</p>

            <div class="quick-access-buttons">
                <a href="#herramientas-consulta" class="button" title="Consulta los espacios curriculares para tu título"><i class="fas fa-search"></i> Explorar Incumbencias</a>
                <button type="button" class="button" onclick="triggerLocalidadSearchAndScroll()" title="Encuentra colegios por ubicación"><i class="fas fa-map-marker-alt"></i> Buscar Colegios</button>
                <a href="#tramites" class="button" title="Guía de trámites docentes"><i class="fas fa-file-alt"></i> Iniciar Trámite</a>
            </div>
        </section>

        <section id="sobre-nosotros" class="content-section">
            <h2>Sobre Nosotros</h2>
            <p>La Junta Calificadora de Méritos y Disciplina garantiza transparencia y equidad en la carrera docente en Salta.</p>
            <h3>Funciones Principales</h3>
            <ul>
                <li>Evaluar y clasificar legajos docentes por mérito.</li>
                <li>Formular nóminas para interinatos y suplencias.</li>
                <li>Dictaminar en traslados, permutas y sanciones.</li>
                <li>Gestionar becas y permanencias en actividad.</li>
                <li>Publicar listas de mérito con transparencia.</li>
            </ul>
            <h3>Composición</h3>
            <p>Conformada por 10 miembros: 6 elegidos por docentes, 3 por el Ministerio y 1 por el sindicato. Mandato de 4 años.</p>
        </section>

        <section id="herramientas-consulta" class="content-section">
            <h2>Herramientas de Consulta</h2>
            <p>Encuentra información sobre títulos, espacios curriculares y colegios. Usa nuestra <a href="#guia-rapida">Guía Rápida</a> si necesitas ayuda.</p>

            <section class="search-group">
                <h3>Buscador de Títulos y Espacios Curriculares <small>(Ideal para docentes ingresantes)</small></h3>
                <div class="tutorial">
                    <p><strong>Paso 1:</strong> Ingresa tu título (ej. "Profesor de Matemática").</p>
                    <p><strong>Paso 2:</strong> Selecciona un espacio curricular de los resultados.</p>
                    <p><strong>Paso 3:</strong> Busca colegios que ofrezcan ese espacio.</p>
                </div>
                <div class="search-section">
                    <label for="tituloInputIntegrado">1. Ingresa tu Título:</label>
                    <input type="text" id="tituloInputIntegrado" placeholder="Ej: Profesor de Matemática">
                    <button onclick="buscarIncumbenciasIntegrado()" aria-label="Buscar espacios curriculares por título">Buscar</button>

                    <div class="results-container">
                        <h3>Resultados de Incumbencias</h3>
                        <div id="incumbenciasResultsIntegrado">
                            <p class="no-results">Aquí se mostrarán los espacios curriculares que puedes dictar.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="search-group">
                <h3>Buscador de Colegios por Espacio Curricular y Ubicación</h3>
                <div class="tutorial">
                    <p><strong>Paso 1:</strong> Selecciona un espacio curricular.</p>
                    <p><strong>Paso 2:</strong> Elige un departamento.</p>
                    <p><strong>Paso 3:</strong> Visualiza colegios que dictan ese espacio.</p>
                </div>
                <div class="search-section">
                    <label for="espacioCurricularSelect">1. Selecciona un Espacio Curricular:</label>
                    <select id="espacioCurricularSelect" disabled>
                        <option value="">-- Selecciona un espacio curricular --</option>
                    </select>

                    <label for="departamentoSelect">2. Selecciona un Departamento:</label>
                    <select id="departamentoSelect" disabled>
                        <option value="">-- Selecciona un departamento --</option>
                    </select>
                    <button onclick="buscarColegiosAleatoriosPorEspacio()" id="btnBuscarColegios" disabled>Buscar Colegios (7 al azar)</button>

                    <div class="results-container">
                        <h3>Colegios Encontrados</h3>
                        <div id="colegiosPorEspacioResults">
                            <p class="no-results">Aquí se mostrarán los colegios.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="search-group">
                <h3>Otras Búsquedas de Colegios</h3>
                <p>Herramientas adicionales para encontrar colegios por diferentes criterios.</p>

                <div class="search-section">
                    <h4>Búsqueda por Orientación</h4>
                    <p>Encuentra colegios secundarios según su orientación educativa.</p>
                    <label for="orientacionInput">Buscar por Orientación:</label>
                    <input type="text" id="orientacionInput" placeholder="Ej: Ciencias Naturales, Informática">
                    <button onclick="buscarOrientaciones()">Buscar Orientaciones</button>

                    <div class="results-container">
                        <h3>Resultados de Orientaciones</h3>
                        <div id="orientacionesResults">
                            <p class="no-results">No hay resultados para mostrar.</p>
                        </div>
                    </div>
                </div>

                <div class="search-section" id="colegios">
                    <h4>Búsqueda por Localidad/Departamento</h4>
                    <p>Encuentra colegios secundarios por localidad o departamento.</p>
                    <label for="localidadInput">Buscar por Localidad o Departamento:</label>
                    <input type="text" id="localidadInput" placeholder="Ej: Salta Capital, Orán">
                    <button id="btnBuscarColegiosLocalidad">Buscar Colegios</button>

                    <div class="results-container">
                        <h3>Resultados de Colegios</h3>
                        <div id="colegiosResults">
                            <p class="no-results">No hay resultados para mostrar.</p>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <section id="normativas" class="content-section">
            <h2>Normativas y Documentos Oficiales</h2>
            <p>Consulta la legislación vigente y documentos relacionados con la función docente.</p>
            <ul>
                <li><a href="http://www.bnm.me.gov.ar/giga1/documentos/EL006396.pdf" target="_blank">Ley N° 7546 - Ley Provincial de Educación</a></li>
                <li><a href="https://boletinoficialsalta.gob.ar/Texto_Actualizado.php?cXdlcnR5dGFibGE9THw2ODMwJmNhYmU9PGg2PiBQdWJsaWNhZG8gZW4gZWwgQm9sZXTDg8KtbiBPZmljaWFsIE7DgsKwIDAsIGVsIGTDg8KtYSAgZGUgIGRlIDwvaDY+PEJSPnF3ZXJ0eQ==" target="_blank">Ley N° 6830/95 - Ley de Educación</a></li>
                <li><a href="https://boletinoficialsalta.gob.ar/instrumento.php?cXdlcnR5dGFibGE9UnwxODUxLzA4cXdlcnR5" target="_blank">Resolución N° 1851/08</a></li>
                <li><a href="https://boletinoficialsalta.gob.ar/instrumento.php?cXdlcnR5dGFibGE9Unw5NzgvMjJxd2VydHk=" target="_blank">Resolución N° 978/22</a></li>
                <li><a href="https://www.edusalta.gov.ar/index.php/docman/normativa-educativa/resoluciones/2698-res-min-no-3666-12/file" target="_blank">Resolución N° 3666/12 - Reglamento para Inscripción en Escuelas de Educación Secundaria y Técnico Profesional</a></li>
            </ul>
        </section>

        <section id="tramites" class="content-section">
            <h2>Trámites y Consultas Frecuentes</h2>
            <p>Resuelve tus dudas y accede a información sobre trámites docentes.</p>

            <h3>Incumbencias Docentes</h3>
            <p>Consulta los espacios curriculares que puedes dictar. Usa el <a href="#herramientas-consulta">buscador de títulos</a>.</p>

            <h3>Inscripciones</h3>
            <p>Sigue los pasos para inscribirte en registros o concursos de la Junta.</p>

            <h3>Convocatorias</h3>
            <p>Infórmate sobre interinatos, suplencias y traslados en la sección <a href="#noticias">Noticias</a>.</p>

            <h3>Preguntas Frecuentes</h3>
            <p>Encuentra respuestas a dudas comunes sobre trámites y procedimientos.</p>
        </section>

        <section id="noticias" class="content-section">
            <h2>Novedades y Noticias</h2>
            <p>Consulta los comunicados oficiales del Ministerio de Educación de Salta.</p>
            <div class="news-iframe-container">
                <iframe src="https://sga.edusalta.gov.ar/Frontend/Modulos/Noticias/Noticias.aspx" title="Noticias Ministerio de Educación"></iframe>
            </div>
            <p><a href="https://sga.edusalta.gov.ar/Frontend/Modulos/Noticias/Noticias.aspx" target="_blank">Ver noticias en el portal del Ministerio</a></p>
        </section>

        <section id="contacto" class="content-section">
            <h2>Contacto</h2>
            <p>Contacta con nosotros para resolver tus consultas:</p>
            <p><strong>Dirección:</strong> Pje Fernando Ramos N° 22, Salta - Capital.</p>
            <p><strong>Teléfonos:</strong> 387 5344660 / 387 5344662</p>
            <p><strong>Email:</strong> <a href="mailto:juntacalificadorasecundario23@gmail.com">juntacalificadorasecundario23@gmail.com</a></p>

            <h3>Nuestra Ubicación</h3>
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3621.579482598387!2d-65.4093959885822!3d-24.62916857997972!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x941bc3a18a99499d%3A0x7df6b0d9e8c4e43b!2sPje%20Fernando%20Ramos%2022%2C%20A4400%20Salta!5e0!3m2!1ses-419!2sar!4v1700000000000!5m2!1ses-419!2sar" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            <p><a href="https://www.google.com/maps/place/Pje+Fernando+Ramos+22,+A4400+Salta" target="_blank">Abrir en Google Maps</a></p>
        </section>
    </div>

    <footer>
        <p>© 2025 Junta Calificadora de Méritos y Disciplina - Nivel Secundario.</p>
        <p>Desarrollado con el apoyo de [Nombre de la Institución].</p>
    </footer>

    <button class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
    console.log('Script principal cargado.');

    const COMPETENCIAS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS-EPPyl34acCgd03fTldc-6Bs7GhBXdAmKVoaIHJKT-5SW4c8VzIDGCNqU7E590SxXlHKPvu-U_qwr/pub?gid=1550756964&single=true&output=csv';
    const ORIENTACIONES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS7Qnph7TWvhLYl3KhpaDVqnYLqgNGbQ7FNtdw7TNzAlskfjVTg4DePvG2MoVuZf9DD3Fc2nZ5CEOms/pub?gid=1943513223&single=true&output=csv';
    const COLEGIOS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vStnrtyd-dwtpz4UlSU2OXrEgL79AlvRLL3c0mIPSGETpyT2sEVgaGjJOVSpryEC7Jhx4zM6HjKWZN_/pub?gid=119647774&single=true&output=csv';
    const PLAN_ESTUDIO_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHqqcFr4mP1vwyt14wUjjMCryhv8bzp-A7Dum5jRKqGvQ5_nJYZlo23Q-90L6cPFKFoUXiFTiMKzI7/pub?gid=151813776&single=true&output=csv';

    let competenciasData = [];
    let orientacionesData = [];
    let colegiosData = [];
    let planEstudioData = [];

    async function loadData(url, type = 'general') {
        const loader = document.getElementById('loader');
        if (loader) loader.classList.add('active');
        try {
            console.log(`Intentando cargar datos desde: ${url} (Tipo: ${type})`);
            const response = await fetch(url, { mode: 'cors' }); // Añadido mode: 'cors' para manejar restricciones
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
            }
            const csvText = await response.text();
            if (!csvText.trim()) {
                throw new Error(`El archivo CSV está vacío o no contiene datos válidos.`);
            }
            const data = parseCSV(csvText, type);
            console.log(`Datos de ${type} cargados exitosamente. Filas: ${data.length}`);
            return data;
        } catch (error) {
            console.error(`Error cargando datos de ${type}:`, error.message);
            alert(`Error al cargar los datos de ${type}: ${error.message}. Por favor, verifica la conexión o la URL.`);
            return [];
        } finally {
            if (loader) loader.classList.remove('active');
        }
    }

    function parseCSV(csvText, type) {
        try {
            const rows = csvText.split('\n').filter(row => row.trim());
            if (rows.length < 2) {
                console.warn(`CSV de ${type} tiene menos de 2 filas.`);
                return [];
            }

            const headers = rows[0].split(',').map(header => header.trim());
            const data = [];

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row.trim()) continue; // Saltar filas vacías
                const values = [];
                let currentValue = '';
                let inQuote = false;

                for (let j = 0; j < row.length; j++) {
                    const char = row[j];
                    if (char === '"') {
                        inQuote = !inQuote;
                    } else if (char === ',' && !inQuote) {
                        values.push(currentValue.trim());
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                values.push(currentValue.trim());

                const obj = {};
                headers.forEach((header, index) => {
                    if (header) {
                        obj[header] = values[index] ? values[index].replace(/^"|"$/g, '').trim() : '';
                    }
                });

                if (type === 'colegios' && obj['Nombre']) {
                    const match = obj['Nombre'].match(/Nº\s*(\d+)/);
                    obj['NumeroUE'] = match ? match[1] : '';
                }

                data.push(obj);
            }
            return data;
        } catch (error) {
            console.error(`Error al parsear CSV de ${type}:`, error);
            return [];
        }
    }

    function normalizeText(text) {
        if (typeof text !== 'string') return '';
        return text.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    }

    function highlightMatch(text, query) {
        if (!text || !query) return text;
        const normalizedText = normalizeText(text);
        const normalizedQuery = normalizeText(query);
        const regex = new RegExp(normalizedQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        let result = text;
        let match;
        while ((match = regex.exec(normalizedText)) !== null) {
            result = result.slice(0, match.index) + `<strong>${text.slice(match.index, match.index + match[0].length)}</strong>` + result.slice(match.index + match[0].length);
            regex.lastIndex = match.index + match[0].length + 15; // Adjust for added <strong> tags
        }
        return result;
    }

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            console.log('Iniciando carga de datos...');
            const [compData, orientData, coleData, planData] = await Promise.all([
                loadData(COMPETENCIAS_URL, 'competencias'),
                loadData(ORIENTACIONES_URL, 'orientaciones'),
                loadData(COLEGIOS_URL, 'colegios'),
                loadData(PLAN_ESTUDIO_URL, 'planEstudio')
            ]);

            competenciasData = compData || [];
            orientacionesData = orientData || [];
            colegiosData = coleData || [];
            planEstudioData = planData || [];

            console.log('Datos cargados:', {
                competenciasCount: competenciasData.length,
                orientacionesCount: orientacionesData.length,
                colegiosCount: colegiosData.length,
                planEstudioCount: planEstudioData.length
            });

            // Asignar eventos solo si los elementos existen
            const btnBuscarColegiosLocalidad = document.getElementById('btnBuscarColegiosLocalidad');
            if (btnBuscarColegiosLocalidad) {
                btnBuscarColegiosLocalidad.addEventListener('click', buscarColegios);
            } else {
                console.warn('Elemento con ID "btnBuscarColegiosLocalidad" no encontrado.');
            }

            populateDepartamentosSelect();
            const espacioCurricularSelect = document.getElementById('espacioCurricularSelect');
            if (espacioCurricularSelect) {
                espacioCurricularSelect.addEventListener('change', toggleBuscarColegiosButton);
            } else {
                console.warn('Elemento con ID "espacioCurricularSelect" no encontrado.');
            }

            const departamentoSelect = document.getElementById('departamentoSelect');
            if (departamentoSelect) {
                departamentoSelect.addEventListener('change', toggleBuscarColegiosButton);
            } else {
                console.warn('Elemento con ID "departamentoSelect" no encontrado.');
            }
        } catch (error) {
            console.error('Error durante la inicialización:', error);
            // Mostrar un mensaje genérico al usuario si falla la inicialización
            const loader = document.getElementById('loader');
            if (loader) loader.classList.remove('active');
            alert('Hubo un error al inicializar la página. Por favor, recarga o verifica tu conexión.');
        }
    });

    window.addEventListener('scroll', () => {
        const backToTop = document.querySelector('.back-to-top');
        backToTop.classList.toggle('active', window.scrollY > 300);
    });

    function renderTable(containerId, headers, data, htmlColumns = [], searchTerm = '', exactHighlightColumn = null) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = '';
        const normalizedSearchTerm = normalizeText(searchTerm);

        if (data.length === 0) {
            container.innerHTML = '<p class="no-results">No se encontraron resultados.</p>';
            return;
        }

        const table = document.createElement('table');
        table.classList.add('results-table');

        const thead = document.createElement('thead');
        const tr = document.createElement('tr');
        headers.forEach(header => {
            const th = document.createElement('th');
            th.textContent = header;
            tr.appendChild(th);
        });
        thead.appendChild(tr);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        data.forEach(item => {
            const tr = document.createElement('tr');
            tr.addEventListener('click', () => mostrarDetallesPorTitulo(item['Titulo'])); // Añadido evento clic
            let shouldHighlight = false;

            if (exactHighlightColumn && item[exactHighlightColumn] !== undefined) {
                if (normalizeText(String(item[exactHighlightColumn])) === normalizedSearchTerm) {
                    shouldHighlight = true;
                }
            } else if (normalizedSearchTerm) {
                shouldHighlight = headers.some(header => {
                    const content = item[header] !== undefined ? String(item[header]) : '';
                    return normalizeText(content).includes(normalizedSearchTerm);
                });
            }

            headers.forEach(header => {
                const td = document.createElement('td');
                const content = item[header] !== undefined ? String(item[header]) : '';
                td.innerHTML = htmlColumns.includes(header) ? content : content.replace(/</g, '<').replace(/>/g, '>');
                tr.appendChild(td);
            });

            if (shouldHighlight) {
                tr.classList.add('highlighted-row');
            }

            tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        container.appendChild(table);
    }

    function buscarOrientaciones() {
        const input = normalizeText(document.getElementById('orientacionInput').value);
        if (!input) {
            renderTable('orientacionesResults', ['UNID EDUCATIVA', 'ORIENTACION', 'AREA GEOGRAFICA- LOCALIDAD-DPTO'], []);
            return;
        }

        const filtered = orientacionesData.filter(item => {
            const orientacion = normalizeText(item['ORIENTACION'] || '');
            const unidEducativa = normalizeText(item['UNID EDUCATIVA'] || '');
            const areaGeo = normalizeText(item['AREA GEOGRAFICA- LOCALIDAD-DPTO'] || '');
            return orientacion.includes(input) || unidEducativa.includes(input) || areaGeo.includes(input);
        });

        renderTable('orientacionesResults', ['UNID EDUCATIVA', 'ORIENTACION', 'AREA GEOGRAFICA- LOCALIDAD-DPTO'], filtered, [], input);
    }

    function buscarColegios() {
        console.log('Función buscarColegios() ejecutada.');
        const inputElement = document.getElementById('localidadInput');
        const rawInput = inputElement.value;
        const normalizedInput = normalizeText(rawInput);
        if (!normalizedInput) {
            renderTable('colegiosResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento', 'CodPostal'], []);
            return;
        }

        const filtered = colegiosData.filter(item => {
            const localidad = normalizeText(item['Localidad'] || '');
            const departamento = normalizeText(item['Departamento'] || '');
            const direccion = normalizeText(item['Direccion'] || '');
            const nombre = normalizeText(item['Nombre'] || '');
            const codPostal = normalizeText(item['CodPostal'] || '');
            return localidad.includes(normalizedInput) || departamento.includes(normalizedInput) || direccion.includes(normalizedInput) || nombre.includes(normalizedInput) || codPostal.includes(normalizedInput);
        });

        renderTable('colegiosResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento', 'CodPostal'], filtered, [], rawInput);
    }

    function triggerLocalidadSearchAndScroll() {
        const localidadInput = document.getElementById('localidadInput');
        if (!localidadInput.value.trim()) {
            localidadInput.value = 'Salta';
        }
        buscarColegios();
        const colegiosSection = document.getElementById('colegios');
        if (colegiosSection) {
            colegiosSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    let foundEspaciosCurriculares = [];

    function populateDepartamentosSelect() {
        const departamentoSelect = document.getElementById('departamentoSelect');
        if (!departamentoSelect) {
            console.warn('Elemento con ID "departamentoSelect" no encontrado. No se puede poblar el select.');
            return;
        }
        departamentoSelect.innerHTML = '<option value="">-- Selecciona un departamento --</option>';

        if (!colegiosData || colegiosData.length === 0) {
            departamentoSelect.disabled = true;
            console.warn('No hay datos de colegios disponibles para poblar el select.');
            return;
        }

        const departamentos = [...new Set(colegiosData.map(item => item['Departamento']).filter(Boolean))].sort();
        if (departamentos.length === 0) {
            console.warn('No se encontraron departamentos en los datos de colegios.');
            return;
        }
        departamentos.forEach(departamento => {
            const option = document.createElement('option');
            option.value = departamento;
            option.textContent = departamento;
            departamentoSelect.appendChild(option);
        });

        departamentoSelect.disabled = false;
    }

    function buscarIncumbenciasIntegrado() {
        const inputElement = document.getElementById('tituloInputIntegrado');
        const rawInput = inputElement.value;
        const normalizedInput = normalizeText(rawInput);
        const selectEspacio = document.getElementById('espacioCurricularSelect');
        const selectDepartamento = document.getElementById('departamentoSelect');
        const btnBuscarColegios = document.getElementById('btnBuscarColegios');

        renderTable('incumbenciasResultsIntegrado', ['Titulo', 'Nombre DEL ESPACIO CURRICULAR', 'CODIGO/Modulo', 'Alcance/INCUMBENCIA'], []);
        renderTable('colegiosPorEspacioResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento'], []);

        if (selectEspacio) selectEspacio.innerHTML = '<option value="">-- Selecciona un espacio curricular --</option>';
        if (selectEspacio) selectEspacio.disabled = true;
        if (btnBuscarColegios) btnBuscarColegios.disabled = true;

        foundEspaciosCurriculares = [];

        if (!normalizedInput) {
            document.getElementById('incumbenciasResultsIntegrado').innerHTML = '<p class="no-results">Por favor, ingresa un título.</p>';
            return;
        }

        const filteredData = competenciasData.filter(item => {
            const titulo = normalizeText(item['Titulo'] || '');
            const espacioCurricular = normalizeText(item['Nombre DEL ESPACIO CURRICULAR'] || '');
            const codigoModulo = normalizeText(item['CODIGO/Modulo'] || '');
            const alcanceIncumbencia = normalizeText(item['Alcance/INCUMBENCIA'] || '');
            return titulo.includes(normalizedInput) || espacioCurricular.includes(normalizedInput) || codigoModulo.includes(normalizedInput) || alcanceIncumbencia.includes(normalizedInput);
        });

        const filteredAndHighlighted = filteredData.map(item => ({
            ...item,
            'Titulo': highlightMatch(item['Titulo'] || '', rawInput)
        }));

        renderTable('incumbenciasResultsIntegrado',
            ['Titulo', 'Nombre DEL ESPACIO CURRICULAR', 'CODIGO/Modulo', 'Alcance/INCUMBENCIA'],
            filteredAndHighlighted,
            ['Titulo'],
            rawInput,
            'Titulo'
        );

        if (filteredAndHighlighted.length > 0 && selectEspacio) {
            foundEspaciosCurriculares = [...new Set(filteredAndHighlighted.map(item => item['Nombre DEL ESPACIO CURRICULAR']).filter(Boolean))].sort();
            foundEspaciosCurriculares.forEach(espacio => {
                const option = document.createElement('option');
                option.value = espacio;
                option.textContent = espacio;
                selectEspacio.appendChild(option);
            });
            selectEspacio.disabled = false;
        } else if (selectEspacio) {
            document.getElementById('incumbenciasResultsIntegrado').innerHTML = '<p class="no-results">No se encontraron espacios curriculares.</p>';
        }
        if (btnBuscarColegios) toggleBuscarColegiosButton();
    }

    function buscarColegiosAleatoriosPorEspacio() {
        const selectedEspacio = document.getElementById('espacioCurricularSelect').value;
        const selectedDepartamento = document.getElementById('departamentoSelect').value;
        renderTable('colegiosPorEspacioResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento'], []);

        if (!selectedEspacio || !selectedDepartamento) {
            document.getElementById('colegiosPorEspacioResults').innerHTML = '<p class="no-results">Selecciona un espacio curricular y un departamento.</p>';
            return;
        }

        const uesEnDepartamento = colegiosData
            .filter(c => c['Departamento'] && normalizeText(c['Departamento']) === normalizeText(selectedDepartamento) && c['NumeroUE'])
            .map(c => String(c['NumeroUE']).trim());

        if (uesEnDepartamento.length === 0) {
            document.getElementById('colegiosPorEspacioResults').innerHTML = `<p class="no-results">No se encontraron colegios en "${selectedDepartamento}".</p>`;
            return;
        }

        const colegiosConEspacio = planEstudioData.filter(item => {
            const espacio = normalizeText(item['ESPACIO CURRICULAR'] || '');
            const ue = String(item['UE'] || '').trim();
            return espacio === normalizeText(selectedEspacio) && uesEnDepartamento.includes(ue);
        });

        if (colegiosConEspacio.length === 0) {
            document.getElementById('colegiosPorEspacioResults').innerHTML = `<p class="no-results">No se encontraron colegios en "${selectedDepartamento}" que dicten "${selectedEspacio}".</p>`;
            return;
        }

        const uniqueUEs = [...new Set(colegiosConEspacio.map(item => String(item['UE']).trim()))];
        const randomUEs = [];
        const maxColegios = Math.min(7, uniqueUEs.length);
        let availableUEs = [...uniqueUEs];

        for (let i = 0; i < maxColegios; i++) {
            const randomIndex = Math.floor(Math.random() * availableUEs.length);
            randomUEs.push(availableUEs[randomIndex]);
            availableUEs.splice(randomIndex, 1);
        }

        const resultados = randomUEs.map(ue => {
            const colegio = colegiosData.find(c => String(c['NumeroUE']).trim() === ue);
            return colegio ? {
                'Nombre': colegio['Nombre'],
                'Direccion': colegio['Direccion'],
                'Localidad': colegio['Localidad'],
                'Departamento': colegio['Departamento']
            } : {
                'Nombre': `Nº ${ue} (Nombre no encontrado)`,
                'Direccion': 'No disponible',
                'Localidad': 'No disponible',
                'Departamento': 'No disponible'
            };
        });

        renderTable('colegiosPorEspacioResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento'], resultados, [], `${selectedEspacio} ${selectedDepartamento}`);
    }

    function toggleBuscarColegiosButton() {
        const selectEspacio = document.getElementById('espacioCurricularSelect');
        const selectDepartamento = document.getElementById('departamentoSelect');
        const btnBuscarColegios = document.getElementById('btnBuscarColegios');
        if (selectEspacio && selectDepartamento && btnBuscarColegios) {
            btnBuscarColegios.disabled = !(selectEspacio.value && selectDepartamento.value);
        }
    }

    function mostrarDetallesPorTitulo(tituloSeleccionado) {
        const normalizedTitulo = normalizeText(tituloSeleccionado);
        const detalles = competenciasData.filter(item => normalizeText(item['Titulo'] || '') === normalizedTitulo);

        if (detalles.length > 0) {
            renderTable('incumbenciasResultsIntegrado',
                ['CODIGO/Modulo', 'Nombre DEL ESPACIO CURRICULAR', 'Alcance/INCUMBENCIA'],
                detalles,
                [],
                ''
            );
        } else {
            document.getElementById('incumbenciasResultsIntegrado').innerHTML = '<p class="no-results">No se encontraron detalles para este título.</p>';
        }
    }
</script>
</body>
</html>
