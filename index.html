<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Junta Calificadora de Méritos y Disciplina - Nivel Secundario</title>
    <link rel="stylesheet" href="style.css"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet"> <style>
        /* Estilos generales mejorados */
        body {
            font-family: 'Roboto', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #eef2f7; /* Un color de fondo más suave */
            color: #333;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Sombra más pronunciada */
            border-radius: 10px; /* Bordes más redondeados */
        }
        h1, h2, h3 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
        }
        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-top: 20px;
            color: #004085; /* Un azul más oscuro */
        }
        h2 {
            font-size: 2em;
            font-weight: 500;
            border-bottom: 2px solid #e0e7ed; /* Línea de separación sutil */
            padding-bottom: 10px;
            margin-top: 40px;
        }
        h3 {
            font-size: 1.5em;
            font-weight: 400;
            color: #007bff;
        }

        /* Header (Encabezado) */
        header {
            background-color: #004085; /* Azul oscuro corporativo */
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        header .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }
        header .logo img {
            max-height: 80px; /* Ajusta el tamaño del logo */
            width: auto;
        }
        header nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex; /* Para poner los elementos del menú en línea */
        }
        header nav ul li {
            margin-left: 25px;
        }
        header nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1em;
            transition: color 0.3s ease-in-out;
        }
        header nav ul li a:hover {
            color: #a7d9ff; /* Un azul más claro al pasar el ratón */
        }

        /* Secciones de Contenido */
        .content-section {
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px dashed #e0e7ed; /* Línea punteada para separar secciones */
        }
        .content-section:last-of-type {
            border-bottom: none; /* Eliminar la línea en la última sección */
        }
        .content-section p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }
        .content-section ul {
            list-style: disc inside;
            margin-left: 20px;
            margin-bottom: 15px;
        }
        .content-section ul li {
            margin-bottom: 8px;
        }
        .content-section a {
            color: #007bff;
            text-decoration: none;
            font-weight: 400;
        }
        .content-section a:hover {
            text-decoration: underline;
        }

        /* Buscadores - Estilos existentes mejorados */
        .search-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dbe2ea; /* Borde más suave */
            border-radius: 8px;
            background-color: #f7f9fc; /* Fondo más claro */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05); /* Sombra interna sutil */
        }
        .search-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
        }
        .search-section input[type="text"],
        .search-section select { /* Añadido estilo para el select */
            width: calc(100% - 22px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #c2d1e2;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box; /* Asegura que padding no aumente el ancho total */
        }
        .search-section button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .search-section button:hover {
            background-color: #0056b3;
        }
        .results-container {
            margin-top: 30px;
            border-top: 1px solid #e0e7ed;
            padding-top: 25px;
        }
        .results-container h3 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden; /* Para que los bordes redondeados se apliquen a la tabla */
        }
        .results-table th, .results-table td {
            border: 1px solid #dee2e6; /* Borde de tabla más definido */
            padding: 12px;
            text-align: left;
        }
        .results-table th {
            background-color: #007bff;
            color: white;
            font-weight: 600;
            text-transform: uppercase; /* Encabezados en mayúsculas */
            font-size: 0.9em;
        }
        .results-table tr:nth-child(even) {
            background-color: #f2f7fb; /* Color de fila par más claro */
        }
        .results-table tr:hover {
            background-color: #e9f2fa; /* Efecto hover en filas */
        }
        .no-results {
            text-align: center;
            color: #777;
            padding: 20px;
            font-style: italic;
        }

        /* Estilos para el iframe */
        .news-iframe-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            padding-top: 75%; /* Proporción 4:3 (altura / ancho * 100%) - Ajusta esto si el sitio se ve cortado */
            height: 0; /* Necesario para mantener la proporción con padding-top */
            background-color: #f0f0f0; /* Color de fondo mientras carga */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .news-iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none; /* Eliminar el borde del iframe */
        }


        /* Footer (Pie de página) */
        footer {
            text-align: center;
            padding: 25px;
            background-color: #343a40; /* Gris oscuro */
            color: white;
            margin-top: 40px;
            border-top: 5px solid #0056b3; /* Borde superior con color primario */
            font-size: 0.9em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header .header-content {
                flex-direction: column;
                text-align: center;
            }
            header nav ul {
                flex-direction: column;
                margin-top: 15px;
            }
            header nav ul li {
                margin: 5px 0;
            }
            .container {
                width: 95%;
                padding: 15px;
            }
            h1 {
                font-size: 2em;
            }
            h2 {
                font-size: 1.7em;
            }
            h3 {
                font-size: 1.3em;
            }
            .search-section input[type="text"],
            .search-section select { /* Full width on smaller screens */
                width: 100%; 
            }
            .news-iframe-container {
                padding-top: 120%; /* Aumenta la altura del iframe en móviles si es necesario */
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="jcmyd-logo.png" alt="Logo Junta Calificadora de Méritos y Disciplina">
            </div>
            <nav>
                <ul>
                    <li><a href="#inicio">Inicio</a></li>
                    <li><a href="#sobre-nosotros">Sobre Nosotros</a></li>
                    <li><a href="#herramientas-consulta">Herramientas de Consulta</a></li>
                    <li><a href="#normativas">Normativas</a></li>
                    <li><a href="#noticias">Noticias</a></li>
                    <li><a href="#contacto">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <section id="inicio" class="content-section">
            <h1>Junta Calificadora de Méritos y Disciplina - Nivel Secundario</h1>
            <p>Bienvenido a la plataforma de consulta de la Junta Calificadora de Méritos y Disciplina de Nivel Secundario de la Provincia de Salta. Aquí podrás encontrar información relevante sobre incumbencias docentes, orientaciones de colegios y datos de instituciones educativas.</p>
            <p>Nuestro objetivo es facilitar el acceso a la información oficial de manera clara y eficiente para toda la comunidad educativa.</p>
        </section>

        <section id="sobre-nosotros" class="content-section">
            <h2>Sobre Nosotros: Junta Calificadora de Méritos y Disciplina</h2>
            <p>La Junta Calificadora de Méritos y Disciplina de Nivel Secundario y sus Modalidades es un organismo permanente y desconcentrado del Ministerio de Educación, Cultura, Ciencia y Tecnología de la Provincia de Salta. Su misión es garantizar la transparencia, equidad y legalidad en la carrera docente, desde el ingreso hasta los ascensos y traslados.</p>
            <p>Conforme a lo establecido en la Ley N.º 8325, que modifica el Estatuto del Educador (Ley N.º 6830), las funciones principales de la Junta incluyen:</p>
            <ul>
                <li>Estudiar y custodiar los legajos de antecedentes de todo el personal docente, efectuando su calificación general por orden de mérito.</li>
                <li>Formular la nómina de aspirantes para el ingreso, interinatos y suplencias en el nivel secundario y sus modalidades.</li>
                <li>Dictaminar en los pedidos de permutas, traslados y reincorporaciones, evaluando cada caso según la normativa vigente.</li>
                <li>Considerar las peticiones de permanencia en actividad, de acuerdo con las disposiciones de las leyes jubilatorias.</li>
                <li>Pronunciarse sobre las solicitudes de becas presentadas por el personal docente.</li>
                <li>Emitir dictámenes previos en casos de aplicación de sanciones disciplinarias, asegurando el debido proceso y el derecho a defensa.</li>
                <li>Dar amplia publicidad a las listas confeccionadas en base al mérito, relativas a ascensos, traslados, interinatos y suplencias, promoviendo la transparencia en los procesos.</li>
            </ul>
            <p>La Junta está integrada por diez miembros: seis elegidos por voto secreto y obligatorio del personal docente, tres designados por el Ministerio y uno propuesto por la asociación sindical con mayor representación en el nivel educativo correspondiente. Los miembros ejercen sus funciones por un período de cuatro años, con posibilidad de reelección por un período adicional.</p>
            <p>Comprometida con el fortalecimiento del sistema educativo provincial, la Junta actúa con independencia técnica y responsabilidad institucional, promoviendo prácticas justas y meritocráticas en beneficio de la comunidad educativa.</p>
        </section>

        <section id="herramientas-consulta" class="content-section">
            <h2>Herramientas de Consulta</h2>
            <p>Accede a nuestras herramientas de búsqueda para encontrar la información que necesitas:</p>

            <section id="competencias-integradas" class="search-section">
                <h3>Buscador Integrado: Títulos y Colegios por Espacio Curricular y Departamento</h3>
                <p>Ingresa tu título para ver los espacios curriculares que puedes dictar. Luego, selecciona un espacio y un departamento para encontrar colegios que lo ofrecen.</p>
                
                <label for="tituloInputIntegrado">1. Ingresa tu Título (o parte de él):</label>
                <input type="text" id="tituloInputIntegrado" placeholder="Ej: Profesor de Historia">
                <button onclick="buscarIncumbenciasIntegrado()">Buscar Espacios Curriculares</button>
                
                <div class="results-container">
                    <h3>Resultados de Incumbencias</h3>
                    <div id="incumbenciasResultsIntegrado">
                        <p class="no-results">Aquí se mostrarán los espacios curriculares que puedes dictar.</p>
                    </div>
                </div>

                <label for="espacioCurricularSelect">2. Selecciona un Espacio Curricular:</label>
                <select id="espacioCurricularSelect" disabled>
                    <option value="">-- Selecciona un espacio curricular --</option>
                </select>

                <label for="departamentoSelect">3. Selecciona un Departamento:</label>
                <select id="departamentoSelect" disabled>
                    <option value="">-- Selecciona un departamento --</option>
                </select>
                <button onclick="buscarColegiosAleatoriosPorEspacio()" id="btnBuscarColegios" disabled>Buscar Colegios (7 al azar)</button>

                <div class="results-container">
                    <h3>Colegios Encontrados</h3>
                    <div id="colegiosPorEspacioResults">
                        <p class="no-results">Aquí se mostrarán los colegios.</p>
                    </div>
                </div>
            </section>

            <section id="orientaciones" class="search-section">
                <h3>Búsqueda de Colegios por Orientación</h3>
                <p>Encuentra colegios secundarios según su orientación educativa.</p>
                <label for="orientacionInput">Buscar por Orientación:</label>
                <input type="text" id="orientacionInput" placeholder="Ej: Ciencias Naturales, Informática, Humanidades">
                <button onclick="buscarOrientaciones()">Buscar Orientaciones</button>

                <div class="results-container">
                    <h3>Resultados de Orientaciones</h3>
                    <div id="orientacionesResults">
                        <p class="no-results">No hay resultados para mostrar.</p>
                    </div>
                </div>
            </section>

            <section id="colegios" class="search-section">
                <h3>Búsqueda de Colegios por Localidad/Departamento</h3>
                <p>Encuentra colegios secundarios ingresando una localidad o departamento.</p>
                <label for="localidadInput">Buscar por Localidad o Departamento:</label>
                <input type="text" id="localidadInput" placeholder="Ej: Salta Capital, San Ramón de la Nueva Orán">
                <button onclick="buscarColegios()">Buscar Colegios</button>

                <div class="results-container">
                    <h3>Resultados de Colegios</h3>
                    <div id="colegiosResults">
                        <p class="no-results">No hay resultados para mostrar.</p>
                    </div>
                </div>
            </section>
        </section>

        <section id="normativas" class="content-section">
            <h2>Normativas y Documentos Oficiales</h2>
            <p>Accede a la legislación vigente y documentos de interés relacionados con la función docente y la Junta Calificadora de Méritos y Disciplina.</p>
            <ul>
                <li><a href="#" target="_blank">Ley Provincial de Educación N° 6.830</a></li>
                <li><a href="#" target="_blank">Reglamento General de Calificación de Méritos y Disciplina</a></li>
                <li><a href="#" target="_blank">Resoluciones y Disposiciones Recientes [Año]</a></li>
                <li><a href="#" target="_blank">Preguntas Frecuentes (FAQ)</a></li>
            </ul>
            <p>[Puedes añadir enlaces a PDFs, documentos en línea o páginas externas aquí.]</p>
        </section>

        <section id="noticias" class="content-section" style="text-align: center;">
            <h2>Novedades y Noticias del Ministerio</h2>
            <p>Aquí puedes consultar las últimas noticias y comunicados oficiales del Ministerio de Educación, Cultura, Ciencia y Tecnología de Salta, incrustados directamente en nuestra página. Si el contenido no carga o tienes problemas para visualizarlo, puedes hacer clic en el enlace directo a continuación.</p>
            
            <div class="news-iframe-container">
                <iframe src="https://sga.edusalta.gov.ar/Frontend/Modulos/Noticias/Noticias.aspx" title="Noticias Ministerio de Educación Salta"></iframe>
            </div>

            <p style="margin-top: 20px;">
                <a href="https://sga.edusalta.gov.ar/Frontend/Modulos/Noticias/Noticias.aspx" target="_blank" style="color: #007bff; text-decoration: underline; font-weight: bold;">
                    Ver noticias directamente en el portal del Ministerio (abre en una nueva pestaña)
                </a>
            </p>
        </section>

        <section id="contacto" class="content-section">
            <h2>Contacto</h2>
            <p>Para consultas adicionales, puedes contactarnos a través de los siguientes medios:</p>
            <p><strong>Dirección:</strong> [Dirección completa del organismo]</p>
            <p><strong>Teléfono:</strong> [Número de teléfono]</p>
            <p><strong>Correo Electrónico:</strong> <a href="mailto:info@ejemplo.com">info@ejemplo.com</a></p>
            <p><strong>Horario de Atención:</strong> [Días y horarios]</p>
        </section>

    </div>

    <footer>
        <p>&copy; 2025 Junta Calificadora de Méritos y Disciplina - Nivel Secundario. Todos los derechos reservados.</p>
        <p>Desarrollado con el apoyo de [Nombre de la Institución/Equipo si aplica]</p>
    </footer>

    <script>
        // URLs de tus Google Sheets publicadas como CSV
        // **IMPORTANTE**: ACTUALIZA LA URL DE COMPETENCIAS_URL CON LA DE TU HOJA NORMALIZADA
        const COMPETENCIAS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS-EPPyl34acCgd03fTldc-6Bs7GhBXdAmKVoaIHJKT-5SW4c8VzIDGCNqU7E590SxXlHKPvu-U_qwr/pub?gid=941984598&single=true&output=csv'; // Reemplaza con la URL de tu CSV normalizado

        const ORIENTACIONES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS7Qnph7TWvhLYl3KhpaDVqnYLqgNGbQ7FNtdw7TNzAlskfjVTg4DePvG2MoVuZf9DD3Fc2nZ5CEOms/pub?output=csv&gid=1943513223';
        const COLEGIOS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vStnrtyd-dwtpz4UlSU2OXrEgL79AlvRLL3c0mIPSGETpyT2sEVgaGjJOVSpryEC7Jhx4zM6HjKWZN_/pub?output=csv&gid=119647774';
        const PLAN_ESTUDIO_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHqqcFr4mP1vwyt14wUjjMCryhv8bzp-A7Dum5jRKqGvQ5_nJYZlo23Q-90L6cPFF FoUXiFTiMKzI7/pub?gid=151813776&single=true&output=csv';

        let competenciasData = [];
        let orientacionesData = [];
        let colegiosData = [];
        let planEstudioData = [];

        // Función para cargar y parsear datos CSV
        async function loadData(url, type = 'generic') {
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                return parseCSV(csvText, type);
            } catch (error) {
                console.error('Error cargando datos de Google Sheets (CSV):', url, error);
                return [];
            }
        }

        // Función para parsear texto CSV a un array de objetos JavaScript
        function parseCSV(csvString, type) {
            const lines = csvString.split('\n');
            if (lines.length < 2) {
                console.warn("CSV tiene menos de 2 líneas (encabezado + datos). Retornando array vacío.");
                return [];
            }

            const headers = lines[0].split(',').map(header => header.trim());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].trim();
                if (currentLine === '') {
                    continue;
                }
                
                // Manejar comas dentro de valores (CSV estándar)
                // Usar una expresión regular para dividir por comas, pero no si están dentro de comillas dobles
                const values = currentLine.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(val => {
                    // Eliminar las comillas si existen y limpiar espacios
                    return val.replace(/^"|"$/g, '').trim();
                });


                const row = {};
                for (let j = 0; j < headers.length; j++) {
                    if (headers[j]) {
                        row[headers[j]] = values[j] ? values[j].trim() : '';
                    }
                }
                
                // Lógica específica para la hoja de COLEGIOS_URL
                if (type === 'colegios' && row['Nombre']) {
                    const match = row['Nombre'].match(/Nº\s*(\d+)/); // Busca "Nº " seguido de números
                    if (match && match[1]) {
                        row['NumeroUE'] = match[1]; // Añade la propiedad NumeroUE con solo los números
                    } else {
                        row['NumeroUE'] = ''; // Si no encuentra, lo deja vacío o un valor por defecto
                        // console.warn(`No se pudo extraer el número de UE del nombre: ${row['Nombre']}`); // Comentado para evitar spam en consola
                    }
                }
                data.push(row);
            }
            return data;
        }

        // Cargar todos los datos al cargar la página
        document.addEventListener('DOMContentLoaded', async () => {
            competenciasData = await loadData(COMPETENCIAS_URL, 'competencias');
            orientacionesData = await loadData(ORIENTACIONES_URL, 'orientaciones');
            colegiosData = await loadData(COLEGIOS_URL, 'colegios');
            planEstudioData = await loadData(PLAN_ESTUDIO_URL, 'planEstudio');
            
            console.log('Datos cargados:', { competenciasData, orientacionesData, colegiosData, planEstudioData });

            // Rellenar el selector de departamentos una vez que colegiosData esté cargado
            populateDepartamentosSelect();
        });

        // Función para renderizar una tabla de resultados
        function renderTable(containerId, headers, data) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<p class="no-results">No se encontraron resultados.</p>';
                return;
            }

            const table = document.createElement('table');
            table.classList.add('results-table');

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            data.forEach(item => {
                const tr = document.createElement('tr');
                headers.forEach(headerKey => {
                    const td = document.createElement('td');
                    td.textContent = item[headerKey] || '';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);

            container.appendChild(table);
        }

        // --- FUNCIONES DE BÚSQUEDA ESPECÍFICAS (Mantenidas para los buscadores independientes) ---

        function buscarOrientaciones() {
            const input = document.getElementById('orientacionInput').value.toLowerCase();
            if (!input) {
                renderTable('orientacionesResults', ['UNID EDUCATIVA', 'ORIENTACION', 'AREA GEOGRAFICA- LOCALIDAD-DPTO'], []);
                return;
            }

            const filtered = orientacionesData.filter(item => {
                const orientacion = item['ORIENTACION'] ? String(item['ORIENTACION']).toLowerCase() : '';
                const unidEducativa = item['UNID EDUCATIVA'] ? String(item['UNID EDUCATIVA']).toLowerCase() : '';
                const areaGeo = item['AREA GEOGRAFICA- LOCALIDAD-DPTO'] ? String(item['AREA GEOGRAFICA- LOCALIDAD-DPTO']).toLowerCase() : '';

                return orientacion.includes(input) || unidEducativa.includes(input) || areaGeo.includes(input);
            });

            renderTable('orientacionesResults', ['UNID EDUCATIVA', 'ORIENTACION', 'AREA GEOGRAFICA- LOCALIDAD-DPTO'], filtered);
        }

        function buscarColegios() {
            const input = document.getElementById('localidadInput').value.toLowerCase();
            if (!input) {
                renderTable('colegiosResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento', 'CodPostal'], []);
                return;
            }

            const filtered = colegiosData.filter(item => {
                const localidad = item['Localidad'] ? String(item['Localidad']).toLowerCase() : '';
                const departamento = item['Departamento'] ? String(item['Departamento']).toLowerCase() : '';
                const direccion = item['Direccion'] ? String(item['Direccion']).toLowerCase() : '';
                const nombre = item['Nombre'] ? String(item['Nombre']).toLowerCase() : '';
                const codPostal = item['CodPostal'] ? String(item['CodPostal']).toLowerCase() : '';

                return localidad.includes(input) || departamento.includes(input) || direccion.includes(input) || nombre.includes(input) || codPostal.includes(input);
            });

            renderTable('colegiosResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento', 'CodPostal'], filtered);
        }


        // --- NUEVAS FUNCIONALIDADES PARA EL BUSCADOR INTEGRADO ---

        let foundEspaciosCurriculares = [];

        function populateDepartamentosSelect() {
            const departamentoSelect = document.getElementById('departamentoSelect');
            departamentoSelect.innerHTML = '<option value="">-- Selecciona un departamento --</option>'; // Limpiar opciones anteriores

            if (colegiosData.length === 0) {
                departamentoSelect.disabled = true;
                return;
            }

            const uniqueDepartamentos = new Set();
            colegiosData.forEach(item => {
                if (item['Departamento']) {
                    uniqueDepartamentos.add(item['Departamento'].trim());
                }
            });

            const sortedDepartamentos = Array.from(uniqueDepartamentos).sort();

            sortedDepartamentos.forEach(departamento => {
                const option = document.createElement('option');
                option.value = departamento;
                option.textContent = departamento;
                departamentoSelect.appendChild(option);
            });

            departamentoSelect.disabled = false; // Habilitar el select de departamentos
        }


        function buscarIncumbenciasIntegrado() {
            const input = document.getElementById('tituloInputIntegrado').value.toLowerCase();
            const selectEspacio = document.getElementById('espacioCurricularSelect');
            const selectDepartamento = document.getElementById('departamentoSelect'); // Nuevo
            const btnBuscarColegios = document.getElementById('btnBuscarColegios');

            // Limpiar resultados anteriores y los selects
            renderTable('incumbenciasResultsIntegrado', ['Titulo', 'Nombre DEL ESPACIO CURRICULAR', 'CODIGO/Modulo', 'Alcance/INCUMBENCIA'], []);
            renderTable('colegiosPorEspacioResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento'], []);
            
            selectEspacio.innerHTML = '<option value="">-- Selecciona un espacio curricular --</option>';
            selectEspacio.disabled = true;
            // selectDepartamento.innerHTML = '<option value="">-- Selecciona un departamento --</option>'; // Ya se llena al inicio
            // selectDepartamento.disabled = true; // Se habilita al cargar datos
            btnBuscarColegios.disabled = true;
            foundEspaciosCurriculares = [];

            if (!input) {
                document.getElementById('incumbenciasResultsIntegrado').innerHTML = '<p class="no-results">Por favor, ingresa un título para buscar incumbencias.</p>';
                return;
            }

            const filtered = competenciasData.filter(item => {
                const titulo = item['Titulo'] ? String(item['Titulo']).toLowerCase() : '';
                return titulo.includes(input);
            });

            renderTable('incumbenciasResultsIntegrado', ['Titulo', 'Nombre DEL ESPACIO CURRICULAR', 'CODIGO/Modulo', 'Alcance/INCUMBENCIA'], filtered);

            // Llenar el select con los espacios curriculares encontrados
            if (filtered.length > 0) {
                const uniqueEspacios = new Set();
                filtered.forEach(item => {
                    if (item['Nombre DEL ESPACIO CURRICULAR']) {
                        uniqueEspacios.add(item['Nombre DEL ESPACIO CURRICULAR'].trim());
                    }
                });

                foundEspaciosCurriculares = Array.from(uniqueEspacios);

                foundEspaciosCurriculares.sort();

                foundEspaciosCurriculares.forEach(espacio => {
                    const option = document.createElement('option');
                    option.value = espacio;
                    option.textContent = espacio;
                    selectEspacio.appendChild(option);
                });
                selectEspacio.disabled = false; // Habilitar el select de espacio curricular
                // btnBuscarColegios se habilita solo si ambos selects tienen valores válidos
                if (selectEspacio.value && selectDepartamento.value) {
                    btnBuscarColegios.disabled = false;
                }
            } else {
                 document.getElementById('incumbenciasResultsIntegrado').innerHTML = '<p class="no-results">No se encontraron espacios curriculares para ese título.</p>';
            }
        }

        function buscarColegiosAleatoriosPorEspacio() {
            const selectedEspacio = document.getElementById('espacioCurricularSelect').value;
            const selectedDepartamento = document.getElementById('departamentoSelect').value; // Obtener departamento seleccionado
            renderTable('colegiosPorEspacioResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento'], []);

            if (!selectedEspacio) {
                document.getElementById('colegiosPorEspacioResults').innerHTML = '<p class="no-results">Por favor, selecciona un espacio curricular.</p>';
                return;
            }
            if (!selectedDepartamento) { // Validar que se haya seleccionado un departamento
                document.getElementById('colegiosPorEspacioResults').innerHTML = '<p class="no-results">Por favor, selecciona un departamento.</p>';
                return;
            }


            // 1. Filtrar los colegios del plan de estudio que dictan el espacio y están en el departamento seleccionado
            const colegiosConEspacioYDepartamento = planEstudioData.filter(item => {
                const espacio = item['ESPACIO CURRICULAR'] ? String(item['ESPACIO CURRICULAR']).toLowerCase() : '';
                // Primero buscamos el detalle del colegio en colegiosData para obtener su departamento
                const colegioDetalle = colegiosData.find(c =>
                    String(c['NumeroUE']).trim() === String(item['UE']).trim() &&
                    String(c['Departamento']).trim().toLowerCase() === selectedDepartamento.toLowerCase()
                );
                
                return espacio === selectedEspacio.toLowerCase() && colegioDetalle;
            });

            if (colegiosConEspacioYDepartamento.length === 0) {
                document.getElementById('colegiosPorEspacioResults').innerHTML = `<p class="no-results">No se encontraron colegios en "${selectedDepartamento}" que dicten "${selectedEspacio}".</p>`;
                return;
            }

            // 2. Obtener los números de UE únicos de colegios filtrados
            const numerosUnicosUEFiltrados = new Set();
            colegiosConEspacioYDepartamento.forEach(item => {
                if (item['UE']) {
                    numerosUnicosUEFiltrados.add(item['UE'].trim());
                }
            });

            const uesDisponibles = Array.from(numerosUnicosUEFiltrados);

            // 3. Seleccionar 7 colegios al azar (o menos si no hay 7)
            const uesAleatorios = [];
            let numColegios = Math.min(7, uesDisponibles.length);
            let tempUEs = [...uesDisponibles];

            for (let i = 0; i < numColegios; i++) {
                const randomIndex = Math.floor(Math.random() * tempUEs.length);
                const randomUE = tempUEs[randomIndex];
                uesAleatorios.push(randomUE);
                tempUEs.splice(randomIndex, 1);
            }

            // 4. Buscar los detalles completos de los colegios seleccionados usando el NumeroUE
            const resultadosFinales = [];
            uesAleatorios.forEach(numeroUE => {
                const colegioDetalle = colegiosData.find(c =>
                    String(c['NumeroUE']).trim() === String(numeroUE).trim()
                );
                if (colegioDetalle) {
                    resultadosFinales.push({
                        'Nombre': colegioDetalle['Nombre'],
                        'Direccion': colegioDetalle['Direccion'],
                        'Localidad': colegioDetalle['Localidad'],
                        'Departamento': colegioDetalle['Departamento']
                    });
                } else {
                    resultadosFinales.push({
                        'Nombre': `Nº ${numeroUE} (Nombre no encontrado)`,
                        'Direccion': 'No disponible',
                        'Localidad': 'No disponible',
                        'Departamento': 'No disponible'
                    });
                    // console.warn(`Detalles no encontrados para el colegio con UE: ${numeroUE}`); // Comentado para evitar spam en consola
                }
            });

            renderTable('colegiosPorEspacioResults', ['Nombre', 'Direccion', 'Localidad', 'Departamento'], resultadosFinales);
        }

        // Habilitar/deshabilitar el botón de búsqueda de colegios
        document.getElementById('espacioCurricularSelect').addEventListener('change', toggleBuscarColegiosButton);
        document.getElementById('departamentoSelect').addEventListener('change', toggleBuscarColegiosButton);

        function toggleBuscarColegiosButton() {
            const selectEspacio = document.getElementById('espacioCurricularSelect');
            const selectDepartamento = document.getElementById('departamentoSelect');
            const btnBuscarColegios = document.getElementById('btnBuscarColegios');

            if (selectEspacio.value && selectDepartamento.value) {
                btnBuscarColegios.disabled = false;
            } else {
                btnBuscarColegios.disabled = true;
            }
        }
    </script>
</body>
</html>
